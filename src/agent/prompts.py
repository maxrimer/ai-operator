def generate_query_for_kb(state) -> str:
    """
    Формирует промпт, состоящий из нескольких ключевых слов сформированных из разговора с клиентом
    для поиска по базе знаний.

    Args:
        state (CallState): Состояние графа

    Returns:
        str: Отформатированный промпт
    """
    return f"""
    Ты работаешь ассистентом в кол-центре банка. Твоя главная задача - находить наиболее релевантные документы,
    чтобы решить вопрос либо проблему клиента. Документы находятся в базе данных, и чтобы лучше всего сделать свою работу 
    ты должен сформулировать КОРОТКИЙ поисковый запрос (3-10 слов, русским языком),
    который поможет найти подходящую статью FAQ. Не добавляй лишних пояснений, пунктуации и кавычек.
    Тебе будет предоставлен полный текст разговора работника колл-центра с клиентом и ты должен в первую очередь
    сфокусироваться на репликах клиента. 

    ИНСТРУКЦИИ:
    1. Всегда ищи главный смысл последней реплики, опираясь на недавнюю историю (2-3 фразы).
    2. Формируй короткий поисковый запрос 3-10 слов русским языком.

       Используй существительные и устойчивые словосочетания.
       Исключай «пустые» слова: я, мне, пожалуйста, здравствуйте.
       Сохраняй важные цифры, даты, валюты.
    3. Если прямых слов не хватает, попробуй:

       Синонимы («досрочное погашение» ⇄ «раньше срока»).
       Официальные банковские термины вместо разговорных.
       Перевод с казахского на русский (если нужно).
    4. Не добавляй лишней пунктуации, кавычек и точек; пиши строчными буквами.
    5. Не включай персональные данные клиента (ФИО, ИИН, телефоны).
    6. Итог выводи только строкой ключевых слов, без пояснений и префиксов.

    Дополнительный контекст предоставлен ниже:

    Текст разгвоора с клиентом: {state.utt}

    Ключевые слова:
    """


def generate_clarify_prompt(state) -> str:
    """
    Формирует промпт для уточнения запроса от клиента.

    Args:
        state (CallState): Состояние графа

    Returns:
        str: Отформатированный промпт
    """
    return f"""
    # ROLE
    Ты — ассистент кол-центра банка. Перед тем как искать статью в FAQ
    ты должен убедиться, что из реплики клиента понятны:
    • **продукт / система / услуга** (Пример: карта, кредит, мобильное приложение, SWIFT и тд)  
    • **действие** (Пример: узнать, подключить, отменить, увеличить, перевести …)
    • **эмоциональная шкала** (от 0 до 100, где 0 - настроение портится, 100 - настроение поднимается)
    
    Если ЛЮБОЙ из этих двух элементов отсутствует — задай уточняющий вопрос.
    
    # ПРАВИЛА ФОРМУЛИРОВКИ
    1. **Один** короткий вопрос, ≤ 120 знаков.  
    2. Вежливая форма: *«Уточните, пожалуйста…»* или *«Могли бы вы…»*.  
    3. НЕ проси личные данные (ФИО / ИИН / номер карты).  
    4. Только русский, без англицизмов, без приветствий и подписей.
    
    # ПРИМЕРЫ  
    | Реплика клиента                                            | Нужно уточнить? | Вопрос-пример                       |
    |------------------------------------------------------------|-----------------|------------------------------------|
    | «Я хочу подключить уведомления»                            | Да, нет продукта| «Уточните, уведомления по карте или по кредиту?» |
    | «Как досрочно погасить?»                                   | Да, нет продукта| «Уточните, досрочно погасить потребительский кредит или ипотеку?» |
    | «Переведи 30 000 тг на карту жены»                         | Нет             | —                                  |
    | «Почему операция в приложении не проходит?»                | Да, нет действия| «Уточните, какую именно операцию вы пытаетесь выполнить в приложении?» |
    | «Сколько осталось платить по кредиту?»                    | Нет             | —                                  |
    
    # ТЕКУЩАЯ РЕПЛИКА КЛИЕНТА
    «{state.utt.strip()}»
    
    СФОРМУЛИРУЙ ВОПРОС

    Пример ответа: (предложение | эмоциональная шкала)
    «Уточните, уведомления по карте или по кредиту?» | 50
    """


def generate_query_valid_prompt(text: str) -> str:
    """
    Формирует ответ является ли реплика вопросом или нет.

    Args:
        text (str): Текущая реплика

    Returns:
        str: Да/Нет
    """
    return f"""
    # ROLE
    Ты – ассистент предварительной фильтрации в кол-центре банка.
    
    # МИССИЯ
    Ответь **ТОЛЬКО «Да» или «Нет»**  
    (без точек, кавычек и пояснений), указывая, является ли реплика
    полным клиентским запросом/командой, требующей банковского действия
    или справки.
    
    # КРИТЕРИИ «Да»
    1. В реплике явно назван банковский продукт, услуга **или** операция  
       (кредит, карта, СМС-банк, досрочное погашение, перевод, валютный контроль…).  
    2. Есть вопросительное слово/знак *или* повелительный глагол + объект.  
    3. Реплика содержит **минимум один смысловой глагол и существительное**,
       описывающее действие или предмет запроса.
    
    # КРИТЕРИИ «Нет»
    - Реплика лишь приветствует, благодарит, извиняется, либо слишком общая
      («хочу узнать», «подскажите, пожалуйста»).  
    - Вопрос не про банковские сервисы.  
    - Запрос обрывается на полуслове, не хватает конкретики.
    
    # ПРИМЕРЫ  
    | Реплика клиента                               | Ответ |
    |-----------------------------------------------|-------|
    | «Сколько осталось платить по потребкредиту?»  | Да    |
    | «Подключи, пожалуйста, СМС-уведомления»        | Да    |
    | «Здравствуйте! Я хотел бы узнать…»            | Нет   |
    | «А если досрочно погасить ипотеку?»           | Да    |
    | «Алло, слышно?»                               | Нет   |
    
    # ПРОВЕРЯЕМАЯ ФРАЗА
    «{text}»
    
    # ОТВЕТ
    Да/Нет
    """















